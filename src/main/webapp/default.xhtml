<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core" 
	xmlns:p="http://primefaces.prime.com.tr/ui">

<ui:composition template="layout.xhtml">
	<ui:define name="content">
		<p:messages showDetail="true" autoUpdate="true"/>
		<p:outputPanel id="registerContainer" >
			<p:outputPanel id="registerPanel" rendered="#{!user.ok and register.registerVisible}" >
				<h2>Register</h2>
				<h:form> 	
		        	<h:panelGrid id="registerGrid" columns="3" cellpadding="5"> 
						<h:outputLabel for="username" value="Username: *" /> 
						<p:inputText id="username" value="#{register.login}" required="true" label="username">
							<f:validator binding="#{userValidator}" />  
                			<p:ajax event="blur" update="usernameMsg" />  
            			</p:inputText>  
            			<p:message id="usernameMsg" for="username" showSummary="true" showDetail="false"/>
            			
            			<h:outputLabel for="email" value="Email: *" />
						<p:inputText id="email" value="#{register.email}" required="true" label="email">
							<f:validator binding="#{emailValidator}" />
                			<p:ajax event="blur" update="emailMsg" />
						</p:inputText>
						<p:message id="emailMsg" for="email" showSummary="true" showDetail="false"/>
						
						<h:outputLabel for="pwd1" value="Password: *" />  
		            	<p:password id="pwd1" value="#{register.password}" feedback="true" label="Password" required="true">  
		            		<f:validator binding="#{passwordValidator}" />
                			<p:ajax event="blur" update="pwd1Msg" />
                		</p:password>
		            	<p:message id="pwd1Msg" for="pwd1" showSummary="true" showDetail="false"/>
		            	
		            	<h:outputLabel for="pwd2" value="Password (again): *" />  
		            	<p:password id="pwd2" value="#{register.password2}" feedback="false" label="Password (again)" required="true"/>
		            	<p:message id="pwd2Msg" for="pwd2" showSummary="true" showDetail="false"/>
		            	
		            	<p:commandButton value="Register" update="registerContainer,loginContainer,loginToggle" actionListener="#{register.register}" />      	
					</h:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:outputPanel>
		<p:outputPanel id="loginContainer" >
			<p:outputPanel id="loginPanel" rendered="#{!user.ok and register.loginVisible}" >
				<h2>Login</h2>
				<h:form>
					<h:panelGrid id="loginGrid" columns="2" cellpadding="5">
						<h:outputLabel for="usernameLogin" value="Username: " /> 
						<p:inputText id="usernameLogin" value="#{register.login}" required="true" label="username"/>
						
						<h:outputLabel for="pwdLogin" value="Password: " />  
		            	<p:password id="pwdLogin" value="#{register.password}" feedback="false"  label="Password" required="true" />
		            	
		            	<p:commandButton value="Login" actionListener="#{register.login}"  update="registerContainer,loginContainer,loginToggle,gameListContainer,newGameContainer,boardContainer" />
					</h:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:outputPanel>
		<p:outputPanel id="gameListContainer" >
			<h:outputText value="gameListContainer: #{user.ok}" /> - <h:outputText value="#{user.user.id}" />
			<p:outputPanel id="gameListPanel" >
				<h2>Game list</h2>
				<table>
					<ui:repeat value="#{game.gameList}" var="g">
						<tr>
							<td><h:outputText value="#{g.playerWhite.login}" /></td>
							<td><h:outputText value="#{g.playerBlack.login}" /></td>
						</tr>
					</ui:repeat>
				</table>		
			</p:outputPanel>
		</p:outputPanel>
		<p:outputPanel id="newGameContainer" >
			<h:outputText value="newGameContainer: #{user.ok}" /> - <h:outputText value="#{user.user.id}" />
			<p:outputPanel id="newGamePanel" rendered="#{user.ok}">
				<h2>New</h2>
				<h:form>
					<h:panelGrid id="newGameGrid" columns="2" cellpadding="5">
						<h:outputLabel for="emailGame" value="Email: " /> 
						<p:inputText id="emailGame" value="#{game.emailNew}" required="true" label="email"/>
						<!--
						<p:inputText id="emailGame" value="#{game.emailNew}" required="true" label="email">
							<f:validator binding="#{emailValidator}" />
                			<p:ajax event="blur" update="emailGameMsg" />
						</p:inputText>
						-->
						<p:message id="emailGameMsg" for="emailGame" showSummary="true" showDetail="false"/>
						<p:commandButton value="Create" update="gameListContainer" actionListener="#{game.create}" />
					</h:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:outputPanel>
		<p:outputPanel id="boardContainer">
			<h:outputText value="boardContainer #{user.ok}" /> - <h:outputText value="#{user.user.id}" />
			<p:outputPanel id="boardPanel" rendered="#{user.ok and !empty board.board}" >
				<table>
					<ui:repeat value="#{board.board.rows}" var="row" >
						<tr>
							<ui:repeat value="#{row.squares}" var="square" >
								<td><h:outputText value="#{square.color}"/><h:outputText value=": #{square.piece.letter}" rendered="#{!empty square.piece}"/></td>
							</ui:repeat>
						</tr>
					</ui:repeat>
				</table>
			</p:outputPanel>
		</p:outputPanel>
	</ui:define>
</ui:composition>
</html>